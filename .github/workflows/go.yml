name: Go

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  build:
    runs-on: ubuntu-latest
    env:
        GH_TOKEN: ${{ github.token }}
    steps:
    - uses: actions/checkout@v2

    - name: Setup Go environment
      uses: actions/setup-go@v2.1.4
      with:
        go-version: 1.17


    - name: Build
      run: git submodule init && git submodule update && cd warehouse && yarn install && yarn build

    - name: Test
      env:
        TOKEN: ${{ github.token }}
      run: |
          bash 
          cd warehouse 
          go get -u github.com/onsi/ginkgo/ginkgo 
          set GH_TOKEN=${{ github.token }}
          ginkgo -r -keepGoing . 
          yarn install && yarn test
          
    - name: GitHub Pages
      uses: crazy-max/ghaction-github-pages@v2.5.0
      env:
        GUTHUB_TOKEN: ${{ github.token }}
      with:
        target_branch: master
        build_dir: warehouse
        committer: Hesham
